<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>💀 Chismesito Duro 💀</title>
<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<style>
body{margin:0;font-family:'Poppins',sans-serif;background:#0a0a0a;color:#fff;}
header{text-align:center;padding:20px;background:#1a0000;box-shadow:0 0 40px #ff0000;}
header h1{color:#ff0000;font-size:2.8em;text-shadow:0 0 20px #ff0000;}
header p{color:#aaa;margin-top:5px;font-size:1.1em;}
#auth-section{max-width:400px;margin:50px auto;text-align:center;}
#auth-section input{width:90%;margin:8px 0;padding:10px;border-radius:8px;border:none;background:#1b0b0b;color:#fff;}
#auth-section button{width:95%;margin:8px 0;padding:10px;border:none;border-radius:8px;background:#ff0000;color:#fff;font-weight:bold;cursor:pointer;transition:0.2s;}
#auth-section button:hover{background:#ff4444;}
#feed-section{display:none;max-width:1000px;margin:20px auto;padding:0 15px;}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:25px;}
.card{background:#120000;border-radius:20px;overflow:hidden;cursor:pointer;position:relative;border:2px solid #330000;box-shadow:0 0 15px #ff0000;transition:0.4s;}
.card:hover{transform:scale(1.05) rotate(-1deg);border-color:#ff4444;box-shadow:0 0 35px #ff0000;}
.card img{width:100%;height:320px;object-fit:cover;display:block;border-bottom:2px solid #330000;transition:0.3s;}
.meta{display:flex;justify-content:space-between;align-items:center;padding:12px 15px;}
.caption{font-weight:bold;font-size:1em;color:#fff;}
.likes{cursor:pointer;color:#ff4444;font-weight:bold;transition:0.3s;}
.likes.liked{color:#ff0000;animation:pop 0.3s;}
@keyframes pop{0%{transform:scale(1);}50%{transform:scale(1.5);}100%{transform:scale(1);}}
.time{font-size:12px;color:#999;padding:0 15px 10px 15px;}
.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);display:none;justify-content:center;align-items:center;z-index:1000;flex-direction:column;}
.modal-content{max-width:90%;max-height:90%;background:#120000;border:3px solid #ff0000;border-radius:20px;overflow:hidden;display:flex;flex-direction:column;animation:slideUp 0.4s ease;}
@keyframes slideUp{from{transform:translateY(50px);opacity:0;}to{transform:translateY(0);opacity:1;}}
.modal img{width:100%;max-height:500px;object-fit:contain;background:#000;}
.modal-meta{padding:15px;}
.modal .likes{font-size:18px;margin-bottom:10px;}
.comments{max-height:220px;overflow-y:auto;margin-bottom:10px;}
.comment{background:#220000;margin-top:5px;padding:6px;border-radius:6px;font-size:14px;}
.comment-input{display:flex;gap:5px;}
.comment-input input{flex:1;padding:6px;border-radius:6px;border:none;background:#1b0b0b;color:#fff;}
.comment-input button{padding:6px 12px;border-radius:6px;border:none;background:#ff0000;color:#fff;cursor:pointer;transition:0.2s;}
.comment-input button:hover{background:#ff4444;}
.close-modal{position:absolute;top:15px;right:25px;font-size:32px;color:#ff0000;cursor:pointer;font-weight:bold;text-shadow:0 0 15px #ff0000;}
</style>
</head>
<body>

<header>
<h1>💀 Chismesito Duro 💀</h1>
<p id="headerText">Regístrate o inicia sesión para ver los chismes 🔥</p>
</header>

<!-- LOGIN / REGISTRO -->
<div id="auth-section">
<input id="name" type="text" placeholder="Nombre (solo para registrarse)">
<input id="email" type="email" placeholder="Correo">
<input id="password" type="password" placeholder="Contraseña">
<button id="loginBtn">Iniciar sesión</button>
<button id="registerBtn">Registrarse</button>
</div>

<!-- FEED -->
<div id="feed-section">
<div id="feed" class="grid"></div>
</div>

<!-- MODAL -->
<div id="modal" class="modal">
<div class="close-modal">&times;</div>
<div class="modal-content">
<img src="" alt="chisme">
<div class="modal-meta">
<div class="likes">❤️ 0</div>
<div class="comments"></div>
<div class="comment-input">
<input type="text" placeholder="Escribe un comentario...">
<button>Comentar</button>
</div>
</div>
</div>
</div>

<script>
// ===== Firebase Config =====
const firebaseConfig = {
  apiKey: "AIzaSyACn125j5x8Kc9iYWdE_2tNRAZlsQCPkXQ",
  authDomain: "chismes-9a0ad.firebaseapp.com",
  projectId: "chismes-9a0ad",
  storageBucket: "chismes-9a0ad.appspot.com",
  messagingSenderId: "890061579997",
  appId: "1:890061579997:web:726eadbfba9cc033e0dd34",
  measurementId: "G-6S910RXE0H"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// ===== Divs =====
const authSection = document.getElementById("auth-section");
const feedSection = document.getElementById("feed-section");
const feedEl = document.getElementById("feed");
const headerText = document.getElementById("headerText");

// ===== Memes subidos por ti (manual) =====
const memes = [
  {id:"1", imageURL:"https://i.imgur.com/abcd123.jpg", caption:"Primer chisme 🔥", createdAt:"2025-10-20 14:00"},
  {id:"2", imageURL:"https://i.imgur.com/efgh456.jpg", caption:"Otro chisme 👀", createdAt:"2025-10-20 15:00"},
  {id:"3", imageURL:"https://i.imgur.com/ijkl789.jpg", caption:"Chisme sicópata 😎", createdAt:"2025-10-20 16:00"}
];

let currentUser = null;

// ===== Registro =====
document.getElementById("registerBtn").addEventListener("click", async ()=>{
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  const name = document.getElementById("name").value;
  if(!email || !password || !name){alert("Completa todos los campos"); return;}
  try{
    const userCred = await auth.createUserWithEmailAndPassword(email,password);
    await userCred.user.updateProfile({displayName:name});
    currentUser = userCred.user;
    authSection.style.display="none";
    feedSection.style.display="block";
    headerText.textContent = "Bienvenido "+currentUser.displayName+" 🔥";
    renderFeed();
  }catch(err){alert(err.message);}
});

// ===== Login =====
document.getElementById("loginBtn").addEventListener("click", async ()=>{
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  if(!email || !password){alert("Completa los campos"); return;}
  try{
    const userCred = await auth.signInWithEmailAndPassword(email,password);
    currentUser = userCred.user;
    authSection.style.display="none";
    feedSection.style.display="block";
    headerText.textContent = "Bienvenido "+currentUser.displayName+" 🔥";
    renderFeed();
  }catch(err){alert(err.message);}
});

// ===== Mantener sesión activa =====
auth.onAuthStateChanged(user=>{
  if(user){
    currentUser = user;
    authSection.style.display="none";
    feedSection.style.display="block";
    headerText.textContent = "Bienvenido "+currentUser.displayName+" 🔥";
    renderFeed();
  } else {
    authSection.style.display="block";
    feedSection.style.display="none";
    headerText.textContent = "Regístrate o inicia sesión para ver los chismes 🔥";
  }
});

// ===== Render Feed =====
async function renderFeed(){
  feedEl.innerHTML="";
  for(const m of memes){
    const doc = await db.collection("posts").doc(m.id).get();
    let data = doc.exists ? doc.data() : {likes:0, likedBy:[], comments:[]};

    const card = document.createElement("div");
    card.className="card";
    const likedClass = currentUser && data.likedBy.includes(currentUser.uid) ? "liked" : "";
    card.innerHTML=`
      <img src="${m.imageURL}" alt="chisme">
      <div class="meta">
        <div class="caption">${m.caption}</div>
        <div class="likes ${likedClass}">❤️ ${data.likes}</div>
      </div>
      <div class="time">🕒 ${m.createdAt}</div>
    `;

    const imgEl = card.querySelector("img");
    const likeEl = card.querySelector(".likes");
    imgEl.addEventListener("click",()=>openModal(m.id));

    likeEl.addEventListener("click", async()=>{
      if(!currentUser){ alert("Inicia sesión"); return; }
      const docRef = db.collection("posts").doc(m.id);
      const docSnap = await docRef.get();
      let postData = docSnap.exists ? docSnap.data() : {likes:0, likedBy:[], comments:[]};
      if(postData.likedBy.includes(currentUser.uid)){
        postData.likes--;
        postData.likedBy = postData.likedBy.filter(u=>u!==currentUser.uid);
      } else {
        postData.likes++;
        postData.likedBy.push(currentUser.uid);
      }
      await docRef.set(postData);
      renderFeed();
    });

    feedEl.appendChild(card);
  }
}

// ===== Modal =====
const modal = document.getElementById("modal");
const modalImg = modal.querySelector("img");
const likesEl = modal.querySelector(".likes");
const commentsDiv = modal.querySelector(".comments");
const input = modal.querySelector(".comment-input input");
const btn = modal.querySelector(".comment-input button");

async function openModal(postId){
  modal.style.display="flex";
  const docSnap = await db.collection("posts").doc(postId).get();
  let data = docSnap.exists ? docSnap.data() : {likes:0, likedBy:[], comments:[]};
  const meme = memes.find(m=>m.id===postId);
  modalImg.src = meme.imageURL;

  function renderModal(){
    const likedClass = currentUser && data.likedBy.includes(currentUser.uid) ? "liked" : "";
    likesEl.className = `likes ${likedClass}`;
    likesEl.textContent = `❤️ ${data.likes}`;
    commentsDiv.innerHTML = "";
    data.comments.forEach(c=>{
      const div = document.createElement("div");
      div.className="comment";
      div.textContent=c;
      commentsDiv.appendChild(div);
    });
  }
  renderModal();

  likesEl.onclick = async()=>{
    if(!currentUser){ alert("Inicia sesión"); return; }
    if(data.likedBy.includes(currentUser.uid)){
      data.likes--; data.likedBy = data.likedBy.filter(u=>u!==currentUser.uid);
    } else {
      data.likes++; data.likedBy.push(currentUser.uid);
    }
    await db.collection("posts").doc(postId).set(data);
    renderModal();
    renderFeed();
  }

  btn.onclick = async()=>{
    const val = input.value.trim();
    if(val){
      data.comments.push(val);
      input.value="";
      await db.collection("posts").doc(postId).set(data);
      renderModal();
      renderFeed();
    }
  }
}

// Cerrar modal
document.querySelector(".close-modal").addEventListener("click",()=>modal.style.display="none");
modal.addEventListener("click",(e)=>{if(e.target.id=="modal") e.target.style.display="none";});
</script>
</body>
</html>

